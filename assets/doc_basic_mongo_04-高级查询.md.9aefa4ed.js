import{_ as e}from"./chunks/1616739691929-b7144c9f-c48e-451a-bae6-b9f2bb8e2f11.91ebe643.js";import{_ as a,o as t,c as l,b as s,d,e as n,a as i,r as p}from"./app.2eac99e3.js";const r=JSON.parse('{"title":"高级查询","description":"","frontmatter":{"sidebarDepth":2},"headers":[{"level":2,"title":"聚合查询","slug":"聚合查询","link":"#聚合查询","children":[{"level":3,"title":"什么是 MongoDB 聚合框架","slug":"什么是-mongodb-聚合框架","link":"#什么是-mongodb-聚合框架","children":[]},{"level":3,"title":"管道(Pipeline)和步骤(Stage)","slug":"管道-pipeline-和步骤-stage","link":"#管道-pipeline-和步骤-stage","children":[]}]},{"level":2,"title":"聚合运算的使用场景","slug":"聚合运算的使用场景","link":"#聚合运算的使用场景","children":[]},{"level":2,"title":"MQL 常用步骤与 SQL 对比","slug":"mql-常用步骤与-sql-对比","link":"#mql-常用步骤与-sql-对比","children":[]},{"level":2,"title":"MQL 特有步骤$unwind","slug":"mql-特有步骤-unwind","link":"#mql-特有步骤-unwind","children":[]},{"level":2,"title":"MQL 特有的$bucket","slug":"mql-特有的-bucket","link":"#mql-特有的-bucket","children":[]},{"level":2,"title":"MQL 特有的$facet","slug":"mql-特有的-facet","link":"#mql-特有的-facet","children":[]}],"relativePath":"doc/basic/mongo/04-高级查询.md","lastUpdated":1684812942000}'),c={name:"doc/basic/mongo/04-高级查询.md"},o=d("h1",{id:"高级查询",tabindex:"-1"},[n("高级查询 "),d("a",{class:"header-anchor",href:"#高级查询","aria-hidden":"true"},"#")],-1),h=i('<h2 id="聚合查询" tabindex="-1">聚合查询 <a class="header-anchor" href="#聚合查询" aria-hidden="true">#</a></h2><h3 id="什么是-mongodb-聚合框架" tabindex="-1">什么是 MongoDB 聚合框架 <a class="header-anchor" href="#什么是-mongodb-聚合框架" aria-hidden="true">#</a></h3><blockquote><p>MongoDB 聚合框架（Aggregation Framework）是一个计算框架，它可以：</p><ul><li>作用在一个集合或者几个集合上</li><li>对集合的数据进行的一些列运算</li><li>讲这些数据转化为期望的形式</li></ul></blockquote><p>从效果而言，聚合框架相当于 SQL 查询中的</p><ul><li>GROUP BY</li><li>LEFT OUTER JOIN</li><li>AS 等等</li></ul><h3 id="管道-pipeline-和步骤-stage" tabindex="-1">管道(Pipeline)和步骤(Stage) <a class="header-anchor" href="#管道-pipeline-和步骤-stage" aria-hidden="true">#</a></h3><ul><li><p>整个聚合运算过程成为管道（Pipeline），它由多个步骤组成；每个管道</p></li><li><ul><li>接受一系列文档（原始数据）</li><li>每个步骤对这些文档进行一系列运算</li><li>结果文档输出给下一个步骤</li></ul></li></ul><p><img src="/docs-page/assets/1616722946746-5f6bcc8c-8fe6-4f06-8803-d48aeef442b8.57e027e9.png" alt="image.png"></p><div class="language-js"><button class="copy"></button><span class="lang">js</span><pre><code><span class="line"><span style="color:#A6ACCD;">pipeline </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [$stage1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> $stage2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">......,</span><span style="color:#A6ACCD;"> $stageN]</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.&lt;</span><span style="color:#A6ACCD;">COLLECTION</span><span style="color:#89DDFF;">&gt;.</span><span style="color:#82AAFF;">aggregate</span><span style="color:#A6ACCD;">(pipeline</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> options </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"></span></code></pre></div><table><thead><tr><th>步骤</th><th>作用</th><th>SQL 等价运算符</th></tr></thead><tbody><tr><td>$match</td><td>过滤</td><td>WHERE</td></tr><tr><td>$project</td><td>投影</td><td>AS</td></tr><tr><td>$sort</td><td>排序</td><td>ORDER BY</td></tr><tr><td>$group</td><td>分组</td><td>GROUP BY</td></tr><tr><td>$skip/$limit</td><td>结果限制</td><td>SKIP/LIMIT</td></tr><tr><td>$looup</td><td>左外连接</td><td>LEFT OUTER JOIN</td></tr><tr><td>$unwind</td><td>展开数组</td><td>N/A</td></tr><tr><td>$graphLoopup</td><td>图搜索</td><td>N/A</td></tr><tr><td>$facet/$bucket</td><td>分页搜索</td><td>N/A</td></tr></tbody></table><h2 id="聚合运算的使用场景" tabindex="-1">聚合运算的使用场景 <a class="header-anchor" href="#聚合运算的使用场景" aria-hidden="true">#</a></h2><ul><li><p>计算；比如</p><ul><li>计算一段时间内的销售总额、均值</li><li>分析一段时间的净利润</li><li>分析购买人的年龄分布</li><li>分析学生成绩分布</li><li>统计员工绩效</li><li>.....</li></ul></li><li><p>数据的复杂运用</p></li></ul><h2 id="mql-常用步骤与-sql-对比" tabindex="-1">MQL 常用步骤与 SQL 对比 <a class="header-anchor" href="#mql-常用步骤与-sql-对比" aria-hidden="true">#</a></h2><p><img src="/docs-page/assets/1616735835149-4fa69238-f7ea-4c8e-b76f-61dc860d2b5b.c1fa6420.png" alt="image.png"></p><p><img src="/docs-page/assets/1616735882990-5e0eaa21-3f88-42df-b98e-1b6d74f1a2af.55e858cd.png" alt="image.png"></p><h2 id="mql-特有步骤-unwind" tabindex="-1">MQL 特有步骤<code>$unwind</code> <a class="header-anchor" href="#mql-特有步骤-unwind" aria-hidden="true">#</a></h2><p><img src="/docs-page/assets/1616735977733-fbf68d59-58d5-4e40-b6b0-cccc8af707af.d1d76df9.png" alt="image.png"></p><h2 id="mql-特有的-bucket" tabindex="-1">MQL 特有的<code>$bucket</code> <a class="header-anchor" href="#mql-特有的-bucket" aria-hidden="true">#</a></h2><p><img src="/docs-page/assets/1616736066821-ec321bb0-cec5-4474-b0ea-e0b28c06e862.95340f60.png" alt="image.png"></p><h2 id="mql-特有的-facet" tabindex="-1">MQL 特有的<code>$facet</code> <a class="header-anchor" href="#mql-特有的-facet" aria-hidden="true">#</a></h2><p><img src="/docs-page/assets/1616736149325-a05797b7-521a-494d-b439-fefd0ae0db4a.37bb9e38.png" alt="image.png"></p><p><img src="'+e+'" alt="image.png"></p>',22);const g=a(c,[["render",function(e,a,d,n,i,r){const c=p("VueJobs");return t(),l("div",null,[o,s(c),h])}]]);export{r as __pageData,g as default};
