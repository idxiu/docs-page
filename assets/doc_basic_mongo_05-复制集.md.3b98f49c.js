import{_ as l}from"./chunks/1616739691929-b7144c9f-c48e-451a-bae6-b9f2bb8e2f11.91ebe643.js";import{_ as i,o as e,c as a,b as d,d as r,e as t,a as n,r as s}from"./app.b322fe29.js";const h=JSON.parse('{"title":"复制集","description":"","frontmatter":{"sidebarDepth":2},"headers":[{"level":2,"title":"复制集的作用","slug":"复制集的作用","link":"#复制集的作用","children":[]},{"level":2,"title":"典型复制集结构","slug":"典型复制集结构","link":"#典型复制集结构","children":[]},{"level":2,"title":"数据是如何复制的？","slug":"数据是如何复制的？","link":"#数据是如何复制的？","children":[]},{"level":2,"title":"选举时如何完成故障恢复的？","slug":"选举时如何完成故障恢复的？","link":"#选举时如何完成故障恢复的？","children":[]},{"level":2,"title":"影响选举的因素","slug":"影响选举的因素","link":"#影响选举的因素","children":[]},{"level":2,"title":"常见选项","slug":"常见选项","link":"#常见选项","children":[]},{"level":2,"title":"复制集注意事项","slug":"复制集注意事项","link":"#复制集注意事项","children":[]},{"level":2,"title":"Atlas-MongoDB 公有云托管服务","slug":"atlas-mongodb-公有云托管服务","link":"#atlas-mongodb-公有云托管服务","children":[]}],"relativePath":"doc/basic/mongo/05-复制集.md","lastUpdated":1663311966000}'),o={name:"doc/basic/mongo/05-复制集.md"},c=r("h1",{id:"复制集",tabindex:"-1"},[t("复制集 "),r("a",{class:"header-anchor",href:"#复制集","aria-hidden":"true"},"#")],-1),u=n('<h2 id="复制集的作用" tabindex="-1">复制集的作用 <a class="header-anchor" href="#复制集的作用" aria-hidden="true">#</a></h2><ul><li>MongoDB 复制集的主要意义在于实现服务高可用</li><li>它的现实依赖于两个方面的功能 <ul><li>数据写入时将数据迅速复制到另一个独立节点上</li><li>在接受写入的节点发生故障是自动选举出一个新的替代节点</li></ul></li><li>在实现高可用的同事，复制集实现了其他几个附加作用 <ul><li>数据分发：将数据从一个区域复制到另一个区域，减少另一个区域的读延迟</li><li>读写分离：不同类型的压力分别在不同的节点上执行</li><li>异地容灾：在数据中心发生故障的时候快速切换到异地</li></ul></li></ul><h2 id="典型复制集结构" tabindex="-1">典型复制集结构 <a class="header-anchor" href="#典型复制集结构" aria-hidden="true">#</a></h2><ul><li>一个典型的复制集由 3 个以上具有投票权的节点组成，包括： <ul><li>一个节点（PRIMARY）：接受读入操作和选举时投票</li><li>连个（或多个）从节点(SECONDERY)：复制节点上的新数据和选举时投票</li><li>不推荐使用 Arbiter（投票节点）</li></ul></li></ul><p><img src="/assets/1616727985993-8c80b589-0adb-468a-b1b1-e9444e0d9998.63b73eb3.png" alt="image.png"></p><h2 id="数据是如何复制的？" tabindex="-1">数据是如何复制的？ <a class="header-anchor" href="#数据是如何复制的？" aria-hidden="true">#</a></h2><ul><li>当一个修改操作，无论是插入、更新或者删除，达到主节点时，它对数据的操作将被记录下来（经过一系列必要的转换），这些记录被称为 <code>oplog</code></li><li>从节点通过在主节点上打开一个 <code>tailable</code> 游标不断获取新进入直接点的 <code>oplog</code>，并在自己的数据上回放，一次保持跟主节点的数据一致性</li></ul><p><img src="/assets/1616736435076-19160d34-62df-4528-9260-d5e68a4773e6.ffd7ca7c.png" alt="image.png"></p><h2 id="选举时如何完成故障恢复的？" tabindex="-1">选举时如何完成故障恢复的？ <a class="header-anchor" href="#选举时如何完成故障恢复的？" aria-hidden="true">#</a></h2><ul><li>具有投票权的节点之间凉凉相互发送心跳</li><li>当 5 次心跳未收到时判断为节点失联（宕机、断网......）</li><li>如果失联的是主节点，从节点会发起选举，选出新的主节点</li><li>如果失恋的是从节点则不会产生新的选举</li><li>选举基于<a href="https://raft.github.io/" target="_blank" rel="noreferrer">RAFT 一致性算法</a>实现，选举成功的必要条件是大多数投票节点存活</li><li>复制集中最多可以有 50 个节点，但具有投票权的节点最多 7 个</li></ul><h2 id="影响选举的因素" tabindex="-1">影响选举的因素 <a class="header-anchor" href="#影响选举的因素" aria-hidden="true">#</a></h2><ul><li>整个集群必须有大多数节点存活</li><li>被选举为主节点的节点必须 <ul><li>能够与多数节点建立连接</li><li>具有较新的 <code>oplog</code>（操作日志）</li><li>具有较高的优先级（如果有配置）</li></ul></li></ul><h2 id="常见选项" tabindex="-1">常见选项 <a class="header-anchor" href="#常见选项" aria-hidden="true">#</a></h2><ul><li>复制及节点有以下常见的选置项： <ul><li>是否具有投票权（v 参数）：有则参与投票（默认都有投票权）</li><li>优先级（priority 参数）：优先级越高的节点越优先成为主节点；优先级为 0 的节点无法成为主节点</li><li>隐藏（hidden 参数）：复制数据，但对应不可见；隐藏节点可以具有投票权，但优先级必须为 0</li><li>延迟（slaveDelay）：复制 n 秒之前的数据，保持与主节点的时间差</li></ul></li></ul><p><img src="/assets/1616737227979-ce259f0d-c75f-41ba-ae0e-63b358176af5.c79579b7.png" alt="image.png"></p><h2 id="复制集注意事项" tabindex="-1">复制集注意事项 <a class="header-anchor" href="#复制集注意事项" aria-hidden="true">#</a></h2><ul><li><p>关于硬件</p><ul><li>因为正常的复制集节点都有可能成为主节点，他们的地位是一样的，因此硬件配置上必须一致</li><li>为例保证节点不会同时宕机，各节点使用的硬件必须具有独立性</li></ul></li><li><p>关于软件</p><ul><li>复制集各节点软件版本必须一致，以避免出现不可预知的问题</li></ul></li><li><p>增加节点不会增加系统写性能</p></li></ul><h2 id="atlas-mongodb-公有云托管服务" tabindex="-1">Atlas-MongoDB 公有云托管服务 <a class="header-anchor" href="#atlas-mongodb-公有云托管服务" aria-hidden="true">#</a></h2><p><img src="'+l+'" alt="image.png"></p>',19);const b=i(o,[["render",function(l,i,r,t,n,h){const o=s("VueJobs");return e(),a("div",null,[c,d(o),u])}]]);export{h as __pageData,b as default};
